{
  "hash": "cea04a3f8fcf7ea493bae71167ccef51",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Viability\"\nauthor: \"Andreas Svendsen\"\neditor: visual\neditor_options: \n  chunk_output_type: console\n---\n\n\n# Viability\n\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(patchwork)\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nhere() starts at C:/Users/alosvendsen/Documents/R/manuscript_one\n```\n\n\n:::\n:::\n\n\n## Load and wrangle data\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndata <- readRDS(here(\"notebooks/viability/data_processed/final_viability.rds\"))\n\n# Convert 'day' to a factor\ndata[, day := as.factor(day)]\n\n# Calculate the mean ATP for each donor on day 5\nmean_day5 <- data[day == 5, .(mean_ATP_day5 = mean(ATP)), by = .(donor)]\n\n# Merge this back with the main data\ndata <- merge(data, mean_day5, by = \"donor\")\n\n# Calculate the relative ATP\ndata[, relative_ATP := ATP / mean_ATP_day5]\n\n# Calculate the mean relative ATP for each donor and day\nmean_data <- data[, .(mean_relative_ATP = mean(relative_ATP)), by = .(day, donor)]\n\n# Calculate the overall mean across all donors for each day\noverall_mean <- mean_data[, .(overall_mean_ATP = mean(mean_relative_ATP)), by = day]\n```\n:::\n\n\n## Plotting\n\n#### Overall relative viability\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Plotting\nplot_relative_viability <- \nggplot() +\n  geom_point(data = mean_data,\n             mapping = aes(x = day, y = mean_relative_ATP, color = as.factor(donor))) +\n  geom_point(data = overall_mean,\n             mapping = aes(x = day, y = overall_mean_ATP),\n             size = 5,\n             alpha = 0.5) +\n  labs(title = \"Mean ATP Relative to Day 5 Across Donors\",\n       x = \"Day\",\n       y = \"Mean Relative ATP\") +\n  scale_y_continuous(\n    name = \"Relative viability\",\n    limits = c(0, NA)\n  )\n```\n:::\n\n::: {#cell-fig-viability-relative-overall .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-viability-relative-overall\n#| fig-cap: \"Note that the concentration of ATP of donor one on day 5 was to high. Data for this donor/day not trustworthy/viability to high. This yields a steep fall from day 5 to 7\"\nplot_relative_viability\n```\n\n::: {.cell-output-display}\n![Note that the concentration of ATP of donor one on day 5 was to high. Data for this donor/day not trustworthy/viability to high. This yields a steep fall from day 5 to 7](Viability_files/figure-html/fig-viability-relative-overall-1.png){#fig-viability-relative-overall width=672}\n:::\n:::\n\n\n#### Overall absolute viability\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndata <- readRDS(here(\"notebooks/viability/data_processed/final_viability.rds\"))\n\nmean_ATP <- data[, mean(ATP, na.rm = TRUE), by = .(day, donor)]\n\nplot_absolute_viability <- \nggplot() +\n  geom_point(\n    data = mean_ATP,\n    mapping = aes(\n      x = day,\n      y = V1,\n      color = as.factor(donor)\n    )\n  ) +\n  labs(title = \"Absolute ATP content\",\n       x = \"Day\",\n       y = \"ATP content (pmol/spheroid\") +\n  scale_y_continuous(limits = c(0, NA))\n```\n:::\n\n::: {#cell-fig-viability-absolute-overall .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-viability-absolute-overall\n#| fig-cap: \"Note that the concentration of ATP of donor one on day 5 was to high. Data for this donor/day not trustworthy/viability to high\"\n#|\nplot_absolute_viability\n```\n\n::: {.cell-output-display}\n![Note that the concentration of ATP of donor one on day 5 was to high. Data for this donor/day not trustworthy/viability to high](Viability_files/figure-html/fig-viability-absolute-overall-1.png){#fig-viability-absolute-overall width=672}\n:::\n:::\n\n\n### Plot individual donors\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Load data ---------------------------------------------------------------\ndata <- readRDS(here(\"notebooks/viability/data_processed/final_viability.rds\"))\n\n\n#### Donor 1 ####\ndonor_1 <- data[donor == 1]\n\ndonor_1[, mean_ATP := mean(ATP), by = .(day)]\n\ncalibrator <- donor_1[day == 5, mean_ATP][1]\n\ndonor_1[, relative_ATP := ATP / calibrator]\n\nplot_donor_1 <- \nggplot(\n  data = donor_1,\n  aes(\n    x=as.factor(day),\n    y = relative_ATP\n    )\n  ) +\n  geom_point() +\n  stat_summary(fun = mean, color = \"red\") +\n  scale_y_continuous(name = \"ATP content relative to day 5\", limits = c(0, 1.5))\n\n\n#### Donor 2 ####\ndonor_2 <- data[donor == 2]\n\ndonor_2[, mean_ATP := mean(ATP), by = .(day)]\n\ncalibrator <- donor_2[day == 5, mean_ATP][1]\n\ndonor_2[, relative_ATP := ATP / calibrator]\n\nplot_donor_2 <- \nggplot(\n  data = donor_2,\n  aes(\n    x=as.factor(day),\n    y = relative_ATP\n  )\n) +\n  geom_point() +\n  stat_summary(fun = mean, color = \"red\") +\n  scale_y_continuous(limits = c(0, 1.5))\n\n\n#### Donor 3 ####\ndonor_3 <- data[donor == 3]\n\ndonor_3[, mean_ATP := mean(ATP), by = .(day)]\n\ncalibrator <- donor_3[day == 5, mean_ATP][1]\n\ndonor_3[, relative_ATP := ATP / calibrator]\n\nplot_donor_3 <- \nggplot(\n  data = donor_3,\n  aes(\n    x=as.factor(day),\n    y = relative_ATP\n  )\n) +\n  geom_point() +\n  stat_summary(fun = mean, color = \"red\")+\n  scale_y_continuous(limits = c(0, 1.5))\n\n\nplot_donor_relative_viability <- \n  wrap_plots(list(plot_donor_1, plot_donor_2, plot_donor_3)) +\n  plot_annotation(title = \"Individual donor viability relative to day 5\")\n\n# ggsave(plot = donor_relative_viability,\n#        filename = here(\"notebooks/viability/output/donor_relative_viability.png\"))\n```\n:::\n\n::: {#cell-fig-donor-viabilities .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-donor-viabilities\n#| fig-width: 10\n#| fig-height: 5\n\nplot_donor_relative_viability\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 5 rows containing missing values (`geom_segment()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 6 rows containing missing values (`geom_segment()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 9 rows containing missing values (`geom_segment()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Viability_files/figure-html/fig-donor-viabilities-1.png){#fig-donor-viabilities width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nrmv <- ls()[-grep(\"plot\", ls())]\nrm(list = rmv, rmv)\n```\n:::\n",
    "supporting": [
      "Viability_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}